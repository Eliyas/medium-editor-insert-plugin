/*! 
 * medium-editor-insert-plugin v2.5.1 - jQuery insert plugin for MediumEditor
 *
 * http://linkesch.com/medium-editor-insert-plugin
 * 
 * Copyright (c) 2014 Pavel Linkesch (http://linkesch.com)
 * Released under the MIT license
 */
!function(t){"function"==typeof define&&define.amd?define(["jquery","handlebars/runtime","medium-editor","blueimp-file-upload","jquery-sortable"],t):"object"==typeof module&&module.exports?module.exports=function(e){if("undefined"==typeof window)throw new Error("medium-editor-insert-plugin runs only in a browser.");return void 0===e&&(e=require("jquery")),window.jQuery=e,Handlebars=require("handlebars/runtime"),MediumEditor=require("medium-editor"),require("jquery-sortable"),require("blueimp-file-upload"),t(0,Handlebars,MediumEditor),e}:t(jQuery,Handlebars,MediumEditor)}(function(e,t,l){this.MediumInsert=this.MediumInsert||{},this.MediumInsert.Templates=this.MediumInsert.Templates||{},this.MediumInsert.Templates["src/js/templates/core-buttons.hbs"]=t.template({1:function(e,t,i,s,o){var n=null!=t?t:e.nullContext||{},a=i.helperMissing,r="function";return'            <li><button data-addon="'+e.escapeExpression(typeof(e=null!=(e=i.key||o&&o.key)?e:a)==r?e.call(n,{name:"key",hash:{},data:o}):e)+'" data-action="add" class="medium-insert-action" type="button">'+(null!=(i=typeof(e=null!=(e=i.label||(null!=t?t.label:t))?e:a)==r?e.call(n,{name:"label",hash:{},data:o}):e)?i:"")+"</button></li>\r\n"},compiler:[7,">= 4.0.0"],main:function(e,t,i,s,o){return'<div class="medium-insert-buttons" contenteditable="false" style="display: none">\r\n    <button class="medium-insert-buttons-show" type="button"><span>+</span></button>\r\n    <ul class="medium-insert-buttons-addons" style="display: none">\r\n'+(null!=(i=i.each.call(null!=t?t:e.nullContext||{},null!=t?t.addons:t,{name:"each",hash:{},fn:e.program(1,o,0),inverse:e.noop,data:o}))?i:"")+"    </ul>\r\n</div>\r\n"},useData:!0}),this.MediumInsert.Templates["src/js/templates/core-caption.hbs"]=t.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,s,o){var n;return'<figcaption contenteditable="true" class="medium-insert-caption-placeholder" data-placeholder="'+e.escapeExpression("function"==typeof(n=null!=(n=i.placeholder||(null!=t?t.placeholder:t))?n:i.helperMissing)?n.call(null!=t?t:e.nullContext||{},{name:"placeholder",hash:{},data:o}):n)+'"></figcaption>'},useData:!0}),this.MediumInsert.Templates["src/js/templates/core-empty-line.hbs"]=t.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,s,o){return"<p><br></p>\r\n"},useData:!0}),this.MediumInsert.Templates["src/js/templates/embeds-toolbar.hbs"]=t.template({1:function(e,t,i,s,o){return'    <div class="medium-insert-embeds-toolbar medium-editor-toolbar medium-toolbar-arrow-under medium-editor-toolbar-active">\r\n        <ul class="medium-editor-toolbar-actions clearfix">\r\n'+(null!=(i=i.each.call(null!=t?t:e.nullContext||{},null!=t?t.styles:t,{name:"each",hash:{},fn:e.program(2,o,0),inverse:e.noop,data:o}))?i:"")+"        </ul>\r\n    </div>\r\n"},2:function(e,t,i,s,o){return null!=(i=i.if.call(null!=t?t:e.nullContext||{},null!=t?t.label:t,{name:"if",hash:{},fn:e.program(3,o,0),inverse:e.noop,data:o}))?i:""},3:function(e,t,i,s,o){var n=null!=t?t:e.nullContext||{},a=i.helperMissing,r="function";return'                    <li>\r\n                        <button class="medium-editor-action" data-action="'+e.escapeExpression(typeof(e=null!=(e=i.key||o&&o.key)?e:a)==r?e.call(n,{name:"key",hash:{},data:o}):e)+'">'+(null!=(i=typeof(e=null!=(e=i.label||(null!=t?t.label:t))?e:a)==r?e.call(n,{name:"label",hash:{},data:o}):e)?i:"")+"</button>\r\n                    </li>\r\n"},5:function(e,t,i,s,o){return'    <div class="medium-insert-embeds-toolbar2 medium-editor-toolbar medium-editor-toolbar-active">\r\n        <ul class="medium-editor-toolbar-actions clearfix">\r\n'+(null!=(i=i.each.call(null!=t?t:e.nullContext||{},null!=t?t.actions:t,{name:"each",hash:{},fn:e.program(2,o,0),inverse:e.noop,data:o}))?i:"")+"        </ul>\r\n    </div>\r\n"},compiler:[7,">= 4.0.0"],main:function(e,t,i,s,o){var n,a=null!=t?t:e.nullContext||{};return(null!=(n=i.if.call(a,null!=t?t.styles:t,{name:"if",hash:{},fn:e.program(1,o,0),inverse:e.noop,data:o}))?n:"")+"\r\n"+(null!=(n=i.if.call(a,null!=t?t.actions:t,{name:"if",hash:{},fn:e.program(5,o,0),inverse:e.noop,data:o}))?n:"")},useData:!0}),this.MediumInsert.Templates["src/js/templates/embeds-wrapper.hbs"]=t.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,s,o){var n;return'<div class="medium-insert-embeds" contenteditable="false">\r\n\t<figure>\r\n\t\t<div class="medium-insert-embed">\r\n\t\t\t'+(null!=(i="function"==typeof(n=null!=(n=i.html||(null!=t?t.html:t))?n:i.helperMissing)?n.call(null!=t?t:e.nullContext||{},{name:"html",hash:{},data:o}):n)?i:"")+'\r\n\t\t</div>\r\n\t</figure>\r\n\t<div class="medium-insert-embeds-overlay"></div>\r\n</div>'},useData:!0}),this.MediumInsert.Templates["src/js/templates/images-fileupload.hbs"]=t.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,s,o){return'<input type="file" multiple>'},useData:!0}),this.MediumInsert.Templates["src/js/templates/images-image.hbs"]=t.template({1:function(e,t,i,s,o){return'        <div class="medium-insert-images-progress"></div>\r\n'},compiler:[7,">= 4.0.0"],main:function(e,t,i,s,o){var n,a=null!=t?t:e.nullContext||{};return'<figure contenteditable="false">\r\n    <img src="'+e.escapeExpression("function"==typeof(n=null!=(n=i.img||(null!=t?t.img:t))?n:i.helperMissing)?n.call(a,{name:"img",hash:{},data:o}):n)+'" alt="" />\r\n'+(null!=(n=i.if.call(a,null!=t?t.progress:t,{name:"if",hash:{},fn:e.program(1,o,0),inverse:e.noop,data:o}))?n:"")+"</figure>\r\n"},useData:!0}),this.MediumInsert.Templates["src/js/templates/images-progressbar.hbs"]=t.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,s,o){return'<progress min="0" max="100" value="0">0</progress>'},useData:!0}),this.MediumInsert.Templates["src/js/templates/images-toolbar.hbs"]=t.template({1:function(e,t,i,s,o){return null!=(i=i.if.call(null!=t?t:e.nullContext||{},null!=t?t.label:t,{name:"if",hash:{},fn:e.program(2,o,0),inverse:e.noop,data:o}))?i:""},2:function(e,t,i,s,o){var n=null!=t?t:e.nullContext||{},a=i.helperMissing,r="function";return'                <li>\r\n                    <button class="medium-editor-action" data-action="'+e.escapeExpression(typeof(e=null!=(e=i.key||o&&o.key)?e:a)==r?e.call(n,{name:"key",hash:{},data:o}):e)+'">'+(null!=(i=typeof(e=null!=(e=i.label||(null!=t?t.label:t))?e:a)==r?e.call(n,{name:"label",hash:{},data:o}):e)?i:"")+"</button>\r\n                </li>\r\n"},4:function(e,t,i,s,o){return'\t<div class="medium-insert-images-toolbar2 medium-editor-toolbar medium-editor-toolbar-active">\r\n\t\t<ul class="medium-editor-toolbar-actions clearfix">\r\n'+(null!=(i=i.each.call(null!=t?t:e.nullContext||{},null!=t?t.actions:t,{name:"each",hash:{},fn:e.program(5,o,0),inverse:e.noop,data:o}))?i:"")+"    \t</ul>\r\n    </div>\r\n"},5:function(e,t,i,s,o){return null!=(i=i.if.call(null!=t?t:e.nullContext||{},null!=t?t.label:t,{name:"if",hash:{},fn:e.program(6,o,0),inverse:e.noop,data:o}))?i:""},6:function(e,t,i,s,o){var n=null!=t?t:e.nullContext||{},a=i.helperMissing,r="function";return'        \t        <li>\r\n        \t            <button class="medium-editor-action" data-action="'+e.escapeExpression(typeof(e=null!=(e=i.key||o&&o.key)?e:a)==r?e.call(n,{name:"key",hash:{},data:o}):e)+'">'+(null!=(i=typeof(e=null!=(e=i.label||(null!=t?t.label:t))?e:a)==r?e.call(n,{name:"label",hash:{},data:o}):e)?i:"")+"</button>\r\n        \t        </li>\r\n"},compiler:[7,">= 4.0.0"],main:function(e,t,i,s,o){var n,a=null!=t?t:e.nullContext||{};return'<div class="medium-insert-images-toolbar medium-editor-toolbar medium-toolbar-arrow-under medium-editor-toolbar-active">\r\n    <ul class="medium-editor-toolbar-actions clearfix">\r\n'+(null!=(n=i.each.call(a,null!=t?t.styles:t,{name:"each",hash:{},fn:e.program(1,o,0),inverse:e.noop,data:o}))?n:"")+"    </ul>\r\n</div>\r\n\r\n"+(null!=(n=i.if.call(a,null!=t?t.actions:t,{name:"if",hash:{},fn:e.program(4,o,0),inverse:e.noop,data:o}))?n:"")},useData:!0}),function(r,l,n,s){"use strict";var o="mediumInsert",a={editor:null,enabled:!0,addons:{images:!0,embeds:!0}};function d(e){return e.charAt(0).toUpperCase()+e.slice(1)}function m(e,t){var i;this.el=e,this.$el=r(e),this.templates=l.MediumInsert.Templates,t&&(i=t.editor,t.editor=null),this.options=r.extend(!0,{},a,t),this.options.editor=i,t&&(t.editor=i),this._defaults=a,this._name=o,this.options&&this.options.editor&&(this.options.editor._serialize===s&&(this.options.editor._serialize=this.options.editor.serialize),this.options.editor._destroy===s&&(this.options.editor._destroy=this.options.editor.destroy),this.options.editor._setup===s&&(this.options.editor._setup=this.options.editor.setup),this.options.editor._hideInsertButtons=this.hideButtons,this.options.editor.serialize=this.editorSerialize,this.options.editor.destroy=this.editorDestroy,this.options.editor.setup=this.editorSetup,this.options.editor.getExtensionByName("placeholder")!==s)&&(this.options.editor.getExtensionByName("placeholder").updatePlaceholder=this.editorUpdatePlaceholder)}m.prototype.init=function(){this.$el.addClass("medium-editor-insert-plugin"),"object"==typeof this.options.addons&&0!==Object.keys(this.options.addons).length||this.disable(),this.initAddons(),this.clean(),this.events()},m.prototype.events=function(){var t=this;this.$el.on("dragover drop",function(e){e.preventDefault()}).on("keyup click",r.proxy(this,"toggleButtons")).on("selectstart mousedown",".medium-insert, .medium-insert-buttons",r.proxy(this,"disableSelection")).on("click",".medium-insert-buttons-show",r.proxy(this,"toggleAddons")).on("click",".medium-insert-action",r.proxy(this,"addonAction")).on("paste",".medium-insert-caption-placeholder",function(e){r.proxy(t,"removeCaptionPlaceholder")(r(e.target))}),r(l).on("resize",r.proxy(this,"positionButtons",null))},m.prototype.getEditor=function(){return this.options.editor},m.prototype.editorSerialize=function(){var i=this._serialize();return r.each(i,function(e){var t=r("<div />").html(i[e].value);t.find(".medium-insert-buttons").remove(),t.find(".medium-insert-active").removeClass("medium-insert-active"),t.find("[data-embed-code]").each(function(){var e=r(this),t=r("<div />").html(e.attr("data-embed-code")).text();e.html(t)}),i[e].value=t.html()}),i},m.prototype.editorDestroy=function(){r.each(this.elements,function(e,t){r(t).data("plugin_"+o)instanceof m&&r(t).data("plugin_"+o).disable()}),this._destroy()},m.prototype.editorSetup=function(){this._setup(),r.each(this.elements,function(e,t){r(t).data("plugin_"+o)instanceof m&&r(t).data("plugin_"+o).enable()})},m.prototype.editorUpdatePlaceholder=function(e,t){var i=r(e).children().not(".medium-insert-buttons").contents();t||1!==i.length||"br"!==i[0].nodeName.toLowerCase()?this.hidePlaceholder(e):(this.showPlaceholder(e),this.base._hideInsertButtons(r(e)))},m.prototype.triggerInput=function(){this.getEditor()&&this.getEditor().trigger("editableInput",null,this.el)},m.prototype.deselect=function(){n.getSelection().removeAllRanges()},m.prototype.disable=function(){this.options.enabled=!1,this.$el.find(".medium-insert-buttons").addClass("hide")},m.prototype.enable=function(){this.options.enabled=!0,this.$el.find(".medium-insert-buttons").removeClass("hide")},m.prototype.disableSelection=function(e){var t=r(e.target);!1!==t.is("img")&&!t.hasClass("medium-insert-buttons-show")||e.preventDefault()},m.prototype.initAddons=function(){var s=this;this.options.addons&&0!==this.options.addons.length&&r.each(this.options.addons,function(e,t){var i=o+d(e);!1===t?delete s.options.addons[e]:(s.$el[i](t),s.options.addons[e]=s.$el.data("plugin_"+i).options)})},m.prototype.clean=function(){var e,t,i=this;!1!==this.options.enabled&&(0===this.$el.html().length&&this.$el.html(this.templates["src/js/templates/core-empty-line.hbs"]().trim()),this.$el.contents().filter(function(){return"#text"===this.nodeName&&""!==r.trim(r(this).text())||"br"===this.nodeName.toLowerCase()}).each(function(){r(this).wrap("<p />"),i.moveCaret(r(this).parent(),r(this).text().length)}),this.addButtons(),(t=(e=this.$el.find(".medium-insert-buttons")).prev()).attr("class"))&&t.attr("class").match(/medium\-insert(?!\-active)/)&&e.before(this.templates["src/js/templates/core-empty-line.hbs"]().trim())},m.prototype.getButtons=function(){if(!1!==this.options.enabled)return this.templates["src/js/templates/core-buttons.hbs"]({addons:this.options.addons}).trim()},m.prototype.addButtons=function(){0===this.$el.find(".medium-insert-buttons").length&&this.$el.append(this.getButtons())},m.prototype.toggleButtons=function(e){var t,i,s,o=r(e.target),e=l.getSelection(),n=this;!1!==this.options.enabled&&((t=e&&0!==e.rangeCount?(e=e.getRangeAt(0),r(e.commonAncestorContainer)):o).hasClass("medium-editor-insert-plugin")&&(t=t.find("p:first")),i=t.is("p")?t:t.closest("p"),this.clean(),!1===o.hasClass("medium-editor-placeholder"))&&0===o.closest(".medium-insert-buttons").length&&0===t.closest(".medium-insert-buttons").length&&(this.$el.find(".medium-insert-active").removeClass("medium-insert-active"),r.each(this.options.addons,function(e){(t=o.closest(".medium-insert-"+e).length?o:t).closest(".medium-insert-"+e).length&&(i=t.closest(".medium-insert-"+e),s=e)}),i.length&&(""===i.text().trim()&&!s||"images"===s)?(i.addClass("medium-insert-active"),"images"===s?this.$el.find(".medium-insert-buttons").attr("data-active-addon",s):this.$el.find(".medium-insert-buttons").removeAttr("data-active-addon"),setTimeout(function(){n.positionButtons(s),n.showButtons(s)},s?100:0)):this.hideButtons())},m.prototype.showButtons=function(e){var t=this.$el.find(".medium-insert-buttons");t.show(),t.find("li").show(),e&&(t.find("li").hide(),t.find('button[data-addon="'+e+'"]').parent().show())},m.prototype.hideButtons=function(e){(e=e||this.$el).find(".medium-insert-buttons").hide(),e.find(".medium-insert-buttons-addons").hide(),e.find(".medium-insert-buttons-show").removeClass("medium-insert-buttons-rotate")},m.prototype.positionButtons=function(e){var t=this.$el.find(".medium-insert-buttons"),i=this.$el.find(".medium-insert-active"),s=i.hasClass("medium-insert-images-grid")?[]:i.find("figure:last figcaption"),o=this.getEditor()?this.getEditor().options.elementsContainer:r("body").get(0),n=-1<["absolute","fixed"].indexOf(l.getComputedStyle(o).getPropertyValue("position")),a={};i.length&&(a.left=i.position().left,a.top=i.position().top,e?(a.left+=i.width()-t.find(".medium-insert-buttons-show").width()-10,a.top+=i.height()-20+(s.length?-s.height()-parseInt(s.css("margin-top"),10):10)):(a.left+=-parseInt(t.find(".medium-insert-buttons-addons").css("left"),10)-parseInt(t.find(".medium-insert-buttons-addons button:first").css("margin-left"),10),a.top+=parseInt(i.css("margin-top"),10)),n&&(a.top+=o.scrollTop),!1===this.$el.hasClass("medium-editor-placeholder")&&a.left<0&&(a.left=i.position().left),t.css(a))},m.prototype.toggleAddons=function(){"images"===this.$el.find(".medium-insert-buttons").attr("data-active-addon")?this.$el.find(".medium-insert-buttons").find('button[data-addon="images"]').click():(this.$el.find(".medium-insert-buttons-addons").fadeToggle(),this.$el.find(".medium-insert-buttons-show").toggleClass("medium-insert-buttons-rotate"))},m.prototype.hideAddons=function(){this.$el.find(".medium-insert-buttons-addons").hide(),this.$el.find(".medium-insert-buttons-show").removeClass("medium-insert-buttons-rotate")},m.prototype.addonAction=function(e){var e=r(e.currentTarget),t=e.data("addon"),e=e.data("action");this.$el.data("plugin_"+o+d(t))[e]()},m.prototype.moveCaret=function(e,t){var i,s,o;t=t||0,i=n.createRange(),s=l.getSelection(),(e=e.get(0)).childNodes.length||(o=n.createTextNode(" "),e.appendChild(o)),i.setStart(e.childNodes[0],t),i.collapse(!0),s.removeAllRanges(),s.addRange(i)},m.prototype.addCaption=function(e,t){0===e.find("figcaption").length&&e.append(this.templates["src/js/templates/core-caption.hbs"]({placeholder:t}))},m.prototype.removeCaptions=function(e){var t=this.$el.find("figcaption");(t=e?t.not(e):t).each(function(){!r(this).hasClass("medium-insert-caption-placeholder")&&""!==r(this).text().trim()||r(this).remove()})},m.prototype.removeCaptionPlaceholder=function(e){e=e.is("figcaption")?e:e.find("figcaption");e.length&&e.removeClass("medium-insert-caption-placeholder").removeAttr("data-placeholder")},r.fn[o]=function(i){return this.each(function(){var e,t=this;r(t).is("textarea")&&(e=r(t).attr("medium-editor-textarea-id"),t=r(t).siblings('[medium-editor-textarea-id="'+e+'"]').get(0)),r.data(t,"plugin_"+o)?"string"==typeof i&&r.data(t,"plugin_"+o)[i]&&r.data(t,"plugin_"+o)[i]():(r.data(t,"plugin_"+o,new m(t,i)),r.data(t,"plugin_"+o).init())})}}(jQuery,window,document),function(l,d,t){"use strict";var i="mediumInsert",s="Embeds",o={label:'<span class="fa fa-youtube-play"></span>',placeholder:"Paste a YouTube, Vimeo, Facebook, Twitter or Instagram link and press Enter",oembedProxy:"http://medium.iframe.ly/api/oembed?iframe=1",captions:!0,captionPlaceholder:"Type caption (optional)",storeMeta:!1,styles:{wide:{label:'<span class="fa fa-align-justify"></span>'},left:{label:'<span class="fa fa-align-left"></span>'},right:{label:'<span class="fa fa-align-right"></span>'}},actions:{remove:{label:'<span class="fa fa-times"></span>',clicked:function(){var e=l.Event("keydown");e.which=8,l(t).trigger(e)}}},parseOnPaste:!1};function n(e,t){this.el=e,this.$el=l(e),this.templates=d.MediumInsert.Templates,this.core=this.$el.data("plugin_"+i),this.options=l.extend(!0,{},o,t),this._defaults=o,this._name=i,this.core.getEditor()&&(this.core.getEditor()._serializePreEmbeds=this.core.getEditor().serialize,this.core.getEditor().serialize=this.editorSerialize),this.init()}n.prototype.init=function(){var e=this.$el.find(".medium-insert-embeds");e.attr("contenteditable",!1),e.each(function(){0===l(this).find(".medium-insert-embeds-overlay").length&&l(this).append(l("<div />").addClass("medium-insert-embeds-overlay"))}),this.events(),this.backwardsCompatibility()},n.prototype.events=function(){l(t).on("click",l.proxy(this,"unselectEmbed")).on("keydown",l.proxy(this,"removeEmbed")).on("click",".medium-insert-embeds-toolbar .medium-editor-action",l.proxy(this,"toolbarAction")).on("click",".medium-insert-embeds-toolbar2 .medium-editor-action",l.proxy(this,"toolbar2Action")),this.$el.on("keyup click paste",l.proxy(this,"togglePlaceholder")).on("keydown",l.proxy(this,"processLink")).on("click",".medium-insert-embeds-overlay",l.proxy(this,"selectEmbed")).on("contextmenu",".medium-insert-embeds-placeholder",l.proxy(this,"fixRightClickOnPlaceholder")),this.options.parseOnPaste&&this.$el.on("paste",l.proxy(this,"processPasted")),l(d).on("resize",l.proxy(this,"autoRepositionToolbars"))},n.prototype.backwardsCompatibility=function(){var e=this;this.$el.find(".mediumInsert-embeds").removeClass("mediumInsert-embeds").addClass("medium-insert-embeds"),this.$el.find(".medium-insert-embeds").each(function(){0===l(this).find(".medium-insert-embed").length&&(l(this).after(e.templates["src/js/templates/embeds-wrapper.hbs"]({html:l(this).html()})),l(this).remove())})},n.prototype.editorSerialize=function(){var s=this._serializePreEmbeds();return l.each(s,function(e){var t=l("<div />").html(s[e].value),i=t.find(".medium-insert-embeds");i.removeAttr("contenteditable"),i.find("figcaption").removeAttr("contenteditable"),t.find(".medium-insert-embeds-overlay").remove(),s[e].value=t.html()}),s},n.prototype.add=function(){var e=this.$el.find(".medium-insert-active");e.html(this.templates["src/js/templates/core-empty-line.hbs"]().trim()),e.is("p")&&(e.replaceWith('<div class="medium-insert-active">'+e.html()+"</div>"),e=this.$el.find(".medium-insert-active"),this.core.moveCaret(e)),e.addClass("medium-insert-embeds medium-insert-embeds-input medium-insert-embeds-active"),this.togglePlaceholder({target:e.get(0)}),e.click(),this.core.hideButtons()},n.prototype.togglePlaceholder=function(e){var e=l(e.target),t=d.getSelection();t&&0!==t.rangeCount&&(t=t.getRangeAt(0),(t=l(t.commonAncestorContainer)).hasClass("medium-insert-embeds-active")?e=t:t.closest(".medium-insert-embeds-active").length&&(e=t.closest(".medium-insert-embeds-active")),e.hasClass("medium-insert-embeds-active")?""===(t=e.text().trim())&&!1===e.hasClass("medium-insert-embeds-placeholder")?e.addClass("medium-insert-embeds-placeholder").attr("data-placeholder",this.options.placeholder):""!==t&&e.hasClass("medium-insert-embeds-placeholder")&&e.removeClass("medium-insert-embeds-placeholder").removeAttr("data-placeholder"):this.$el.find(".medium-insert-embeds-active").remove())},n.prototype.fixRightClickOnPlaceholder=function(e){this.core.moveCaret(l(e.target))},n.prototype.processLink=function(e){var t,i=this.$el.find(".medium-insert-embeds-active");i.length&&(""===(t=i.text().trim())&&-1!==[8,46,13].indexOf(e.which)?i.remove():13===e.which&&(e.preventDefault(),e.stopPropagation(),this.options.oembedProxy?this.oembed(t):this.parseUrl(t)))},n.prototype.processPasted=function(e){l(".medium-insert-embeds-active").length||(e=e.originalEvent.clipboardData.getData("text"),new RegExp("^(http(s?):)?//","i").test(e)&&(this.options.oembedProxy?this.oembed(e,!0):this.parseUrl(e,!0)))},n.prototype.oembed=function(o,i){var n=this;l.support.cors=!0,l.ajax({crossDomain:!0,cache:!1,url:this.options.oembedProxy,dataType:"json",data:{url:o},success:function(e){var t=e&&e.html;n.options.storeMeta&&(t+='<div class="medium-insert-embeds-meta"><script type="text/json">'+JSON.stringify(e)+"<\/script></div>"),((t=e&&!t&&"photo"===e.type&&e.url?'<img src="'+e.url+'" alt="">':t)?i?l.proxy(n,"embed",t,o):l.proxy(n,"embed",t):l.proxy(n,"convertBadEmbed",o))()},error:function(e,t,i){var s=function(){try{return JSON.parse(e.responseText)}catch(e){}}();void 0!==d.console?d.console.log(s&&s.error||e.status||i.message):d.alert("Error requesting media from "+n.options.oembedProxy+" to insert: "+i+" (response status: "+e.status+")"),l.proxy(n,"convertBadEmbed",o)()}})},n.prototype.parseUrl=function(e,t){var i;return!new RegExp(["youtube","youtu.be","vimeo","instagram","twitter","facebook"].join("|")).test(e)||(i=e.replace(/\n?/g,"").replace(/^((http(s)?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/(watch\?v=|v\/)?)([a-zA-Z0-9\-_]+)(.*)?$/,'<div class="video video-youtube"><iframe width="420" height="315" src="//www.youtube.com/embed/$7" frameborder="0" allowfullscreen></iframe></div>').replace(/^https?:\/\/vimeo\.com(\/.+)?\/([0-9]+)$/,'<div class="video video-vimeo"><iframe src="//player.vimeo.com/video/$2" width="500" height="281" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div>').replace(/^https:\/\/twitter\.com\/(\w+)\/status\/(\d+)\/?$/,'<blockquote class="twitter-tweet" align="center" lang="en"><a href="https://twitter.com/$1/statuses/$2"></a></blockquote><script async src="//platform.twitter.com/widgets.js" charset="utf-8"><\/script>').replace(/^(https:\/\/www\.facebook\.com\/(.*))$/,'<script src="//connect.facebook.net/en_US/sdk.js#xfbml=1&amp;version=v2.2" async><\/script><div class="fb-post" data-href="$1"><div class="fb-xfbml-parse-ignore"><a href="$1">Loading Facebook post...</a></div></div>').replace(/^https?:\/\/instagram\.com\/p\/(.+)\/?$/,'<span class="instagram"><iframe src="//instagram.com/p/$1/embed/" width="612" height="710" frameborder="0" scrolling="no" allowtransparency="true"></iframe></span>'),this.options.storeMeta&&(i+='<div class="medium-insert-embeds-meta"><script type="text/json">'+JSON.stringify({})+"<\/script></div>"),!1===/<("[^"]*"|'[^']*'|[^'">])*>/.test(i))?(l.proxy(this,"convertBadEmbed",e)(),!1):void(t?this.embed(i,e):this.embed(i))},n.prototype.embed=function(e,t){var i,s=this.$el.find(".medium-insert-embeds-active");if(!e)return alert("Incorrect URL format specified"),!1;-1<e.indexOf("<\/script>")&&(i=l("<div>").attr("data-embed-code",l("<div />").text(e).html()).html(e),e=l("<div>").append(i).html()),t?((s=this.$el.find(":not(iframe, script, style)").contents().filter(function(){return 3===this.nodeType&&-1<this.textContent.indexOf(t)}).parent()).after(this.templates["src/js/templates/embeds-wrapper.hbs"]({html:e})),s.text(s.text().replace(t,""))):(s.after(this.templates["src/js/templates/embeds-wrapper.hbs"]({html:e})),s.remove()),this.core.triggerInput(),-1!==e.indexOf("facebook")&&"undefined"!=typeof FB&&setTimeout(function(){FB.XFBML.parse()},2e3)},n.prototype.convertBadEmbed=function(e){var t=this.templates["src/js/templates/core-empty-line.hbs"]().trim(),i=this.$el.find(".medium-insert-embeds-active"),s=l(t);i.before(s),i.remove(),s.html(e),i=l(t),s.after(i),this.core.triggerInput(),this.core.moveCaret(i)},n.prototype.selectEmbed=function(e){var t,i=this;this.core.options.enabled&&((t=l(e.target).hasClass("medium-insert-embeds")?l(e.target):l(e.target).closest(".medium-insert-embeds")).addClass("medium-insert-embeds-selected"),setTimeout(function(){i.addToolbar(),i.options.captions&&i.core.addCaption(t.find("figure"),i.options.captionPlaceholder)},50))},n.prototype.unselectEmbed=function(e){var t=l(e.target).hasClass("medium-insert-embeds")?l(e.target):l(e.target).closest(".medium-insert-embeds"),i=this.$el.find(".medium-insert-embeds-selected");t.hasClass("medium-insert-embeds-selected")?(i.not(t).removeClass("medium-insert-embeds-selected"),l(".medium-insert-embeds-toolbar, .medium-insert-embeds-toolbar2").remove(),this.core.removeCaptions(t.find("figcaption")),(l(e.target).is(".medium-insert-caption-placeholder")||l(e.target).is("figcaption"))&&(t.removeClass("medium-insert-embeds-selected"),this.core.removeCaptionPlaceholder(t.find("figure")))):(i.removeClass("medium-insert-embeds-selected"),l(".medium-insert-embeds-toolbar, .medium-insert-embeds-toolbar2").remove(),l(e.target).is(".medium-insert-caption-placeholder")?this.core.removeCaptionPlaceholder(t.find("figure")):!1===l(e.target).is("figcaption")&&this.core.removeCaptions())},n.prototype.removeEmbed=function(e){var t;8!==e.which&&46!==e.which||(t=this.$el.find(".medium-insert-embeds-selected")).length&&(e.preventDefault(),l(".medium-insert-embeds-toolbar, .medium-insert-embeds-toolbar2").remove(),e=l(this.templates["src/js/templates/core-empty-line.hbs"]().trim()),t.before(e),t.remove(),this.core.hideAddons(),this.core.moveCaret(e),this.core.triggerInput())},n.prototype.addToolbar=function(){var e,t,i=this.$el.find(".medium-insert-embeds-selected"),s=!1;0!==i.length&&(t=this.core.getEditor().options.elementsContainer||"body",l(t).append(this.templates["src/js/templates/embeds-toolbar.hbs"]({styles:this.options.styles,actions:this.options.actions}).trim()),t=l(".medium-insert-embeds-toolbar"),e=l(".medium-insert-embeds-toolbar2"),t.find("button").each(function(){i.hasClass("medium-insert-embeds-"+l(this).data("action"))&&(l(this).addClass("medium-editor-button-active"),s=!0)}),!1===s&&t.find("button").first().addClass("medium-editor-button-active"),this.repositionToolbars(),t.fadeIn(),e.fadeIn())},n.prototype.autoRepositionToolbars=function(){setTimeout(function(){this.repositionToolbars(),this.repositionToolbars()}.bind(this),0)},n.prototype.repositionToolbars=function(){var e=l(".medium-insert-embeds-toolbar"),t=l(".medium-insert-embeds-toolbar2"),i=this.$el.find(".medium-insert-embeds-selected"),s=this.core.getEditor().options.elementsContainer,o=-1<["absolute","fixed"].indexOf(d.getComputedStyle(s).getPropertyValue("position")),n=o?s.getBoundingClientRect():null,a=l(d).width(),r={};t.length&&(r.top=i.offset().top+2,r.left=i.offset().left+i.width()-t.width()-4,o&&(r.top+=s.scrollTop-n.top,r.left-=n.left,a=l(s).width()),r.left+t.width()>a&&(r.left=a-t.width()),t.css(r)),e.length&&(r.left=i.offset().left+i.width()/2-e.width()/2,r.top=i.offset().top-e.height()-8-2-5,o&&(r.top+=s.scrollTop-n.top,r.left-=n.left),r.top<0&&(r.top=0),e.css(r))},n.prototype.toolbarAction=function(e){var e=l(e.target).is("button")?l(e.target):l(e.target).closest("button"),t=e.closest("li"),i=t.closest("ul").find("li"),s=this.$el.find(".medium-insert-embeds-selected"),o=this;e.addClass("medium-editor-button-active"),t.siblings().find(".medium-editor-button-active").removeClass("medium-editor-button-active"),i.find("button").each(function(){var e="medium-insert-embeds-"+l(this).data("action");l(this).hasClass("medium-editor-button-active")?(s.addClass(e),(o.options.styles[l(this).data("action")]||{}).added&&o.options.styles[l(this).data("action")].added(s)):(s.removeClass(e),(o.options.styles[l(this).data("action")]||{}).removed&&o.options.styles[l(this).data("action")].removed(s))}),this.core.triggerInput()},n.prototype.toolbar2Action=function(e){e=l(e.target).is("button")?l(e.target):l(e.target).closest("button"),e=(this.options.actions[e.data("action")]||{}).clicked;e&&e(this.$el.find(".medium-insert-embeds-selected")),this.core.triggerInput()},l.fn[i+s]=function(e){return this.each(function(){l.data(this,"plugin_"+i+s)||l.data(this,"plugin_"+i+s,new n(this,e))})}}(jQuery,window,document),function(d,m,u){"use strict";var i="mediumInsert",t="Images",s={label:'<span class="fa fa-camera"></span>',deleteMethod:"POST",deleteScript:"delete.php",preview:!0,captions:!0,captionPlaceholder:"Type caption for image (optional)",autoGrid:3,fileUploadOptions:{url:null,acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i},fileDeleteOptions:{},styles:{wide:{label:'<span class="fa fa-align-justify"></span>'},left:{label:'<span class="fa fa-align-left"></span>'},right:{label:'<span class="fa fa-align-right"></span>'},grid:{label:'<span class="fa fa-th"></span>'}},actions:{remove:{label:'<span class="fa fa-times"></span>',clicked:function(){var e=d.Event("keydown");e.which=8,d(u).trigger(e)}}},sorting:function(){var e=this;d(".medium-insert-images").sortable({group:"medium-insert-images",containerSelector:".medium-insert-images",itemSelector:"figure",placeholder:'<figure class="placeholder">',handle:"img",nested:!1,vertical:!1,afterMove:function(){e.core.triggerInput()}})},messages:{acceptFileTypesError:"This file is not in a supported format: ",maxFileSizeError:"This file is too big: "}};function o(e,t){this.el=e,this.$el=d(e),this.$currentImage=null,this.templates=m.MediumInsert.Templates,this.core=this.$el.data("plugin_"+i),this.options=d.extend(!0,{},s,t),this._defaults=s,this._name=i,this.options.preview&&!m.FileReader&&(this.options.preview=!1),this.core.getEditor()&&(this.core.getEditor()._serializePreImages=this.core.getEditor().serialize,this.core.getEditor().serialize=this.editorSerialize),this.init()}o.prototype.init=function(){var e=this.$el.find(".medium-insert-images");e.find("figcaption").attr("contenteditable",!0),e.find("figure").attr("contenteditable",!1),this.events(),this.backwardsCompatibility(),this.sorting()},o.prototype.events=function(){d(u).on("click",d.proxy(this,"unselectImage")).on("keydown",d.proxy(this,"removeImage")).on("click",".medium-insert-images-toolbar .medium-editor-action",d.proxy(this,"toolbarAction")).on("click",".medium-insert-images-toolbar2 .medium-editor-action",d.proxy(this,"toolbar2Action")),this.$el.on("click",".medium-insert-images img",d.proxy(this,"selectImage")),d(m).on("resize",d.proxy(this,"autoRepositionToolbars"))},o.prototype.backwardsCompatibility=function(){this.$el.find(".mediumInsert").removeClass("mediumInsert").addClass("medium-insert-images"),this.$el.find(".medium-insert-images.small").removeClass("small").addClass("medium-insert-images-left")},o.prototype.editorSerialize=function(){var i=this._serializePreImages();return d.each(i,function(e){var t=d("<div />").html(i[e].value);t.find(".medium-insert-images").find("figcaption, figure").removeAttr("contenteditable"),t.find(".medium-insert-images-progress").remove(),i[e].value=t.html()}),i},o.prototype.add=function(){var i=this,e=d(this.templates["src/js/templates/images-fileupload.hbs"]()),t={dataType:"json",add:function(e,t){d.proxy(i,"uploadAdd",e,t)()},done:function(e,t){d.proxy(i,"uploadDone",e,t)()}};(new XMLHttpRequest).upload&&(t.progress=function(e,t){d.proxy(i,"uploadProgress",e,t)()},t.progressall=function(e,t){d.proxy(i,"uploadProgressall",e,t)()}),e.fileupload(d.extend(!0,{},this.options.fileUploadOptions,t)),e.click()},o.prototype.uploadAdd=function(e,t){var i,s=this.$el.find(".medium-insert-active"),o=this,n=[],a=t.files[0],r=this.options.fileUploadOptions.acceptFileTypes,l=this.options.fileUploadOptions.maxFileSize;if(r&&!r.test(a.type)?n.push(this.options.messages.acceptFileTypesError+a.name):l&&a.size>l&&n.push(this.options.messages.maxFileSizeError+a.name),0<n.length)return this.options.uploadFailed&&"function"==typeof this.options.uploadFailed?void this.options.uploadFailed(n,t):void alert(n.join("\n"));this.core.hideButtons(),s.is("p")&&(s.replaceWith('<div class="medium-insert-active">'+s.html()+"</div>"),(s=this.$el.find(".medium-insert-active")).next().is("p")||s.after("<p><br></p>"),this.core.moveCaret(s.next())),s.addClass("medium-insert-images"),!1===this.options.preview&&0===s.find("progress").length&&(new XMLHttpRequest).upload&&s.append(this.templates["src/js/templates/images-progressbar.hbs"]()),(t.autoUpload||!1!==t.autoUpload&&d(e.target).fileupload("option","autoUpload"))&&t.process().done(function(){o.options.preview?(i=u.createElement("img"),m.URL=m.URL||m.webkitURL,i.src=m.URL.createObjectURL(t.files[0]),i.onload=function(){d.proxy(o,"showImage",this.src,t)(),setTimeout(function(){m.URL.revokeObjectURL(this.src)})}):t.submit()})},o.prototype.uploadProgressall=function(e,t){var i;!1===this.options.preview&&(t=parseInt(t.loaded/t.total*100,10),(i=this.$el.find(".medium-insert-active").find("progress")).attr("value",t).text(t),100===t)&&i.remove()},o.prototype.uploadProgress=function(e,t){var i;this.options.preview&&(i=100-parseInt(t.loaded/t.total*100,10),(t=t.context.find(".medium-insert-images-progress")).css("width",i+"%"),0==i)&&t.remove()},o.prototype.uploadDone=function(e,t){d.proxy(this,"showImage",t.result.files[0].url,t)(),this.core.clean(),this.sorting()},o.prototype.showImage=function(e,t){var i,s,o=this.$el.find(".medium-insert-active");return o.click(),(s=this).options.preview&&t.context?((i=this.getDOMImage()).onload=function(){t.context.find("img").attr("src",e),this.options.uploadCompleted&&this.options.uploadCompleted(t.context,t),s.core.triggerInput()}.bind(this),i.src=e):(t.context=d(this.templates["src/js/templates/images-image.hbs"]({img:e,progress:this.options.preview})).appendTo(o),o.find("br").remove(),this.options.autoGrid&&o.find("figure").length>=this.options.autoGrid&&(d.each(this.options.styles,function(e,t){o.removeClass("medium-insert-images-"+e),t.removed&&t.removed(o)}),o.addClass("medium-insert-images-grid"),this.options.styles.grid.added)&&this.options.styles.grid.added(o),this.options.preview?t.submit():this.options.uploadCompleted&&this.options.uploadCompleted(t.context,t)),this.core.triggerInput(),t.context},o.prototype.getDOMImage=function(){return new m.Image},o.prototype.selectImage=function(e){var t,i=this;this.core.options.enabled&&(t=d(e.target),this.$currentImage=t,this.$el.blur(),t.addClass("medium-insert-image-active"),t.closest(".medium-insert-images").addClass("medium-insert-active"),setTimeout(function(){i.addToolbar(),i.options.captions&&i.core.addCaption(t.closest("figure"),i.options.captionPlaceholder)},50))},o.prototype.unselectImage=function(e){var e=d(e.target),t=this.$el.find(".medium-insert-image-active");e.is("img")&&e.hasClass("medium-insert-image-active")?(t.not(e).removeClass("medium-insert-image-active"),d(".medium-insert-images-toolbar, .medium-insert-images-toolbar2").remove(),this.core.removeCaptions(e)):(t.removeClass("medium-insert-image-active"),d(".medium-insert-images-toolbar, .medium-insert-images-toolbar2").remove(),e.is(".medium-insert-caption-placeholder")?this.core.removeCaptionPlaceholder(t.closest("figure")):!1===e.is("figcaption")&&this.core.removeCaptions(),this.$currentImage=null)},o.prototype.removeImage=function(e){var t,i,s,o,n,a=[],r=this.$el.find(".medium-insert-image-active");if((8===e.which||46===e.which)&&(r.length&&a.push(r),(r=m.getSelection())&&r.rangeCount&&(o="#text"===(r=r.getRangeAt(0).commonAncestorContainer).nodeName||"BR"===r.nodeName?d(r).parent():d(r),r=l.selection.getCaretOffsets(r).left,8===e.which&&0===r?s=o.prev():46===e.which&&r===o.text().length&&(s=o.next()),s&&s.hasClass("medium-insert-images")&&a.push(s.find("img")),o=l.selection.getSelectionHtml(u))&&d("<div></div>").html(o).find(".medium-insert-images img").each(function(){a.push(d(this))}),a.length)){for(n=0;n<a.length;n++)this.deleteFile(a[n].attr("src"),a[n]),t=a[n].closest(".medium-insert-images"),a[n].closest("figure").remove(),0===t.find("figure").length&&(!1!==(i=t.next()).is("p")&&""===i.text()||(i=d(this.templates["src/js/templates/core-empty-line.hbs"]().trim()),t.before(i)),t.remove());this.core.hideAddons(),!o&&i&&(e.preventDefault(),this.core.moveCaret(i)),d(".medium-insert-images-toolbar, .medium-insert-images-toolbar2").remove(),this.core.triggerInput()}},o.prototype.deleteFile=function(e,t){this.options.deleteScript&&("function"==typeof this.options.deleteScript?this.options.deleteScript(e,t):d.ajax(d.extend(!0,{},{url:this.options.deleteScript,type:this.options.deleteMethod||"POST",data:{file:e}},this.options.fileDeleteOptions)))},o.prototype.addToolbar=function(){var e,t=this.$el.find(".medium-insert-image-active").closest(".medium-insert-images"),i=!1,s=this.core.getEditor().options.elementsContainer||"body";d(s).append(this.templates["src/js/templates/images-toolbar.hbs"]({styles:this.options.styles,actions:this.options.actions}).trim()),s=d(".medium-insert-images-toolbar"),e=d(".medium-insert-images-toolbar2"),s.find("button").each(function(){t.hasClass("medium-insert-images-"+d(this).data("action"))&&(d(this).addClass("medium-editor-button-active"),i=!0)}),!1===i&&s.find("button").first().addClass("medium-editor-button-active"),this.repositionToolbars(),s.fadeIn(),e.fadeIn()},o.prototype.autoRepositionToolbars=function(){setTimeout(function(){this.repositionToolbars(),this.repositionToolbars()}.bind(this),0)},o.prototype.repositionToolbars=function(){var e=d(".medium-insert-images-toolbar"),t=d(".medium-insert-images-toolbar2"),i=this.$el.find(".medium-insert-image-active"),s=this.core.getEditor().options.elementsContainer,o=-1<["absolute","fixed"].indexOf(m.getComputedStyle(s).getPropertyValue("position")),n=o?s.getBoundingClientRect():null,a=d(m).width(),r={};t.length&&(r.top=i.offset().top+2,r.left=i.offset().left+i.width()-t.width()-4,o&&(r.top+=s.scrollTop-n.top,r.left-=n.left,a=d(s).width()),r.left+t.width()>a&&(r.left=a-t.width()),t.css(r)),e.length&&(i.closest(".medium-insert-images-grid-active").length&&(i=i.closest(".medium-insert-images-grid-active")),r.top=i.offset().top-e.height()-8-2-5,r.left=i.offset().left+i.width()/2-e.width()/2,o&&(r.top+=s.scrollTop-n.top,r.left-=n.left),r.top<0&&(r.top=0),e.css(r))},o.prototype.toolbarAction=function(e){var t,i,s,o=this;null!==this.$currentImage&&(i=(t=(e=d(e.target).is("button")?d(e.target):d(e.target).closest("button")).closest("li")).closest("ul").find("li"),s=this.$el.find(".medium-insert-active"),e.addClass("medium-editor-button-active"),t.siblings().find(".medium-editor-button-active").removeClass("medium-editor-button-active"),i.find("button").each(function(){var e="medium-insert-images-"+d(this).data("action");d(this).hasClass("medium-editor-button-active")?(s.addClass(e),o.options.styles[d(this).data("action")].added&&o.options.styles[d(this).data("action")].added(s)):(s.removeClass(e),o.options.styles[d(this).data("action")].removed&&o.options.styles[d(this).data("action")].removed(s))}),this.core.hideButtons(),this.core.triggerInput())},o.prototype.toolbar2Action=function(e){null!==this.$currentImage&&(e=d(e.target).is("button")?d(e.target):d(e.target).closest("button"),(e=this.options.actions[e.data("action")].clicked)&&e(this.$el.find(".medium-insert-image-active")),this.core.hideButtons(),this.core.triggerInput())},o.prototype.sorting=function(){d.proxy(this.options.sorting,this)()},d.fn[i+t]=function(e){return this.each(function(){d.data(this,"plugin_"+i+t)||d.data(this,"plugin_"+i+t,new o(this,e))})}}(jQuery,window,document,l.util)});